<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sdRacer - code your way out</title>
    <link rel="stylesheet" href="Assets/Styles/newGameStyles.css">
    <link rel="stylesheet" href="Assets/External/CodeMirror/codemirror.min.css">
</head>
<body>
    <div class="content">
        <div class="title">
            <h1>sdRacer - code your way out</h1>
        </div>

        <div class="instructions">
            <h2>Uitleg</h2>
            <p>In dit spel is het de bedoeling dat je de auto naar de finish rijdt, door de auto te programmeren. Programmeer de auto door in het codeveld jouw code te typen en druk dan op "Play" om te kijken wat je auto doet. </p>
            <p>Ieder level begint met een kleine hint. Kijk wat de code doet door op 'Play' te drukken. Klik op 'Help' om te zien welke commando's je kunt gebruiken, en voor meer informatie.</p>
        </div>
        
        <div class="gameButtons">
            <button id="homeBtn">Levels</button>
            <button id="infoBtn">Help</button>
            <button id="saveBtn">Save</button>
            <button id="loadBtn">Load</button>
            <button id="checkCodeBtn">Check Code</button>
            <button id="fixIndentationBtn">Fix Indentation</button>
            <button id="playBtn">Play</button>
            <button id="resetLvlBtn">Reset Level</button>
            <button id="resetBtn">Reset Code</button>
        </div>
        
        <div class="main">
            <div class="gameContainer">
                <div id="game"></div>
            </div>
            
            <div class="codeContainer">
                <div id="code-editor-container" class="code-editor-container">
                    <div class="editor-header">
                        <span class="editor-title">CarLang Code Editor</span>
                        <div class="editor-controls">
                            <span id="line-count" class="line-count">0 lines</span>
                        </div>
                    </div>
                    <div class="editor-body">
                        <div id="code-editor"></div>
                    </div>
                </div>
                
                <div class="debug">
                    <div id="parser-display" class="parser-display">
                        <div class="parser-header">
                            <span class="parser-title">Code Analysis</span>
                            <span id="validation-status" class="validation-status">Ready</span>
                        </div>
                        <div class="parser-content">
                            <span class="unparsed">Click "Check Code" to analyze your CarLang code</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Win Message Modal -->
    <div id="win-message">
        <div class="win-message-content">
            <div class="win-message-modal">
                <h2>Level Complete!</h2>
                <div id="win-details" class="win-details">
                    <p>Congratulations! You completed the level!</p>
                </div>
                <div class="win-message-buttons">
                    <button id="retryBtn">Try Again</button>
                    <button id="nextLevelBtn">Next Level</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Info Overlay -->
    <div id="info-overlay" class="info-overlay">
        <div class="info-content">
            <div class="info-header">
                <h2>sdRacer - Programming Guide</h2>
                <button id="closeInfoBtn" class="close-btn">Ã—</button>
            </div>
            <div class="info-body">
                <p>sdRacer is a programming game where you write code to control cars and navigate them to the finish line.</p>
                
                <h3>Game Modes</h3>
                <ul>
                    <li><strong>Single Car Mode:</strong> Control one car using simple function calls</li>
                    <li><strong>Multi-Car Mode:</strong> Control multiple cars using object-oriented syntax</li>
                </ul>
                
                <h3>Available Commands</h3>
                <div class="command-section">
                    <h4>Movement Commands:</h4>
                    <ul>
                        <li><code>moveForward()</code> - Move car forward one tile</li>
                        <li><code>moveBackward()</code> - Move car backward one tile</li>
                        <li><code>turnRight()</code> - Turn car right by 90 degrees</li>
                        <li><code>turnLeft()</code> - Turn car left by 90 degrees</li>
                    </ul>
                </div>
                
                <div class="command-section">
                    <h4>Sensor Commands:</h4>
                    <ul>
                        <li><code>isRoadAhead()</code> - Check if there's a road ahead</li>
                        <li><code>isCowAhead()</code> - Check if there's a cow ahead</li>
                        <li><code>isAtFinish()</code> - Check if car is at finish line</li>
                    </ul>
                </div>
                
                <div class="command-section">
                    <h4>Action Commands:</h4>
                    <ul>
                        <li><code>honk()</code> - Honk the car horn (scares cows)</li>
                    </ul>
                </div>
                
                <h3>Control Structures</h3>
                <ul>
                    <li><code>if (condition) { ... }</code> - Execute code if condition is true</li>
                    <li><code>while (condition) { ... }</code> - Execute code while condition is true</li>
                    <li><code>for (int i = 0; i < 10; i = i + 1) { ... }</code> - Execute code 10 times</li>
                </ul>
                
                <h3>Tips</h3>
                <ul>
                    <li>Use "Check Code" to validate your syntax before running</li>
                    <li>Save your code frequently with the "Save" button</li>
                    <li>Use loops to avoid repetitive code</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script type="module" src="Assets/Scripts/commonFunctions.js"></script>
    <script type="module" src="Assets/Scripts/soundController.js"></script>
    <script type="module" src="Assets/Scripts/code-validator.js"></script>
    <script type="module" src="Assets/Scripts/CarLang-parser.js"></script>
    <script type="module" src="Assets/Scripts/game.js"></script>
    <script type="module" src="Assets/Scripts/ui-code-validator.js"></script>
    <script src="Assets/External/CodeMirror/codemirror.min.js"></script>
    <script src="Assets/Scripts/CodeMirrorCustomMode.js"></script>
    <script>
    // Use the custom mode for CarLang
    const carlangModeInstance = new CodeMirrorCustomMode();
    
    CodeMirror.defineMode('carlang', () => ({
        startState: () => carlangModeInstance.startState(),
        token: (stream, state) => carlangModeInstance.token(stream, state),
        indent: (state, textAfter) => carlangModeInstance.indent(state, textAfter),
        electricChars: "{}",
        lineComment: '//',
        fold: 'brace',
        copyState: (state) => ({ depth: state.depth })
    }));
    </script>
    <script type="module">
    // Initialize CodeMirror
    window.codeMirrorEditor = CodeMirror(document.getElementById('code-editor'), {
        value: '',
        lineNumbers: true,
        mode: 'carlang',
        theme: 'default',
        indentUnit: 2,
        tabSize: 2,
        smartIndent: true,
        indentWithTabs: false,
        electricChars: true,
        autofocus: true,
    });
    
    // Make the CodeMirror instance available to the custom mode
    carlangModeInstance.cm = window.codeMirrorEditor;
    
    // Helper to get/set code (replace all codeArea.value usage in JS with these)
    window.getCodeValue = () => window.codeMirrorEditor.getValue();
    window.setCodeValue = (val) => window.codeMirrorEditor.setValue(val);
    </script>
</body>
</html>